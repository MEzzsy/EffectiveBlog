# 成员的各种调用方式

## 非静态成员函数

nonstatic member function 和一般的nonmember function有相同的效率。

```cpp
float magnitude3d(const Point3d* this) {...}//nonmember function
float Point3d::magnitude3d() const {...}//nonstatic member function
```

nonstatic member function在内部会转为nonmember function：

1.  改写函数原型，增加一个额外参数用来传递this指针。
2.  对非静态成员变量的存取改为通过this来完成。
3.  将成员函数名称进行混淆。

**名称混淆**

一般处理方法是方法名称+类+参数类型。不同编译器混淆的方式不同。

编译器可以混淆名称，也可以反混淆名称。

## 虚拟成员函数

如果normalize()是一个virtual member function，那么

```cpp
ptr->normalize();
```

将会被内部转化为：

```cpp
(*ptr->vptr[1])(ptr);
```

其中：

-   vptr表示由编译器产生的指针，指向virtual table。它被安插在每一个声明有(或继承自)一个或多个virtual functions的class object中。（其名称也会被混淆，因为在一个复杂的class派生体系中，可能存在多个vptrs）。
-   1是virtual table slot的索引值，关联到normalize()函数。
-   第二个ptr表示this指针。

>   normalize是一个函数，内部会调用magnitude()

magnitude()调用类似。

如果用类作用运算符调用虚函数，其决议方式和非静态成员函数一样。

编译器的一种优化方式：如果是通过对象（不是指针和引用）调用虚函数，编译器可以决议成非静态成员函数。